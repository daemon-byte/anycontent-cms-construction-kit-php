<div class="modal-dialog" style="width:900px">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="myModalLabel">Please Choose Geolocation {{ name }}</h4>
        </div>
        <div class="modal-body">
            <div style="width:860px;height: 400px">
                <div id="map-canvas" style="width: 100%; height:100%"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="modal_button_select">Select</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
    </div>
    <script>
        $(document).ready(function () {

            $(document).on("cmck", function (e, params) {

                switch (params.type) {


                    case 'modal.shown.geolocation':

                        var lat = '{{ lat }}';
                        var long = '{{ long }}';

                        var map;


                            console.log(params.options.name);

                        if (lat != '' && long != '') {
                            var mapOptions = {
                                zoom: 10,
                                center: new google.maps.LatLng(lat, long)
                            };
                        }
                        else {
                            var mapOptions = {
                                zoom: 2,
                                center: new google.maps.LatLng(0,0)
                            };
                        }

                        map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

                        marker = new google.maps.Marker(
                                {
                                    map: map,
                                    draggable: true,
                                    animation: google.maps.Animation.DROP,
                                    position: map.getCenter()
                                });

                        google.maps.event.addListener(marker, 'dragend', function () {
                            console.log(marker.getPosition());


                        });

                        $('#modal_button_select').click(function () {
                            params.options.lat.val(marker.getPosition().d);
                            params.options.long.val(marker.getPosition().e);
                            console.log('select button');
                            $('#modal_edit').modal('hide');
                        });


                        break;
                }
                ;

            });


        });

    </script>
</div>

