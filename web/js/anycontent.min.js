/*! anycontent 2017-07-19 */

function cmck_modal_id(e,t,n){e="#"+e,$(e).off("shown.bs.modal"),$(e).on("shown.bs.modal",function(){"function"==typeof n&&n()}),void 0!==t&&($(e).removeData(),$(e+" .modal-header").html(""),$(e+" .modal-body").html(""),$(e+" .modal-footer").html("")),$(e).appendTo("body"),$(e).modal({keyboard:!0}),$(e).load(t)}function cmck_modal(e,t){cmck_modal_id("modal_edit",e,t)}function cmck_modal_id_hide(e){e="#"+e,$(e).modal("hide")}function cmck_modal_hide(){cmck_modal_id_hide("modal_edit")}function cmck_modal_set_property(e,t){$("#form_edit [name="+e+"]").val(t)}function cmck_set_var(e,t){"object"!=typeof $.cmck&&($.cmck={}),$.cmck[e]=t}function cmck_get_var(e,t){return $.cmck[e]}function cmck_trigger_change(e){$(e).trigger("change"),$("iframe").each(function(t,n){"function"==typeof n.contentWindow.cmck_sequence_trigger_change&&n.contentWindow.cmck_sequence_trigger_change(e)})}function cmck_message_info(e){$("#messages").html('<div class="alert alert-info">'+e+"</div>"),$(document).scrollTop(0),$("#messages div").delay(3e3).fadeOut(500)}function cmck_message_alert(e){$("#messages").html('<div class="alert alert-warning">'+e+"</div>"),$(document).scrollTop(0),$("#messages div").delay(3e3).fadeOut(500)}function cmck_message_error(e){$("#messages").html('<div class="alert alert-danger">'+e+"</div>"),$(document).scrollTop(0),$("#messages div").delay(3e3).fadeOut(500)}function cmck_get_cookie(e){var t=window.document.cookie.split(e+"=");if(2==t.length)return t.pop().split(";").shift()}function cmck_delete_cookie(e){document.cookie=encodeURIComponent(e)+"=deleted; expires="+new Date(0).toUTCString()}function cmck_document(){return document}function cmck_sequence_trigger_change(e){$(e).trigger("change")}$(document).on("cmck",function(e,t){switch(t.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":$(".formelement-popover").popover({html:!0}),$(".formelement-tooltip").popover({html:!0})}}),$(document).ready(function(){}),$(document).on("cmck",function(e,t){switch(t.type){case"editform.setProperty":$("#form_edit [name="+t.property+"]").val(t.value),1==t.save&&0==parseInt($("#form_edit").attr("data-event-countdown"))&&$("#form_edit").submit()}}),$(document).ready(function(){$("#form_edit_button_save_options a").click(function(){return $("#form_edit_button_save").removeClass("open"),$("#form_edit_button_save input:first").attr("value",$(this).text()),$("#form_edit_button_save_operation").attr("value",$(this).attr("data-operation")),!1}),$("#form_edit_button_submit").click(function(){return $.event.trigger("cmck",{type:"editform.Save"}),$("#form_edit").submit(),!1}),$("#form_edit").submit(function(){return countdown=parseInt($("#form_edit").attr("data-event-countdown")),0==countdown&&(counterrors=0,$(".form-group.mandatory").each(function(){$(this).removeClass("has-error"),idFormelement=$(this).attr("data-formelement"),val="",$('[id^="'+idFormelement+'"]').each(function(){val+=$(this).val().trim(),console.log(val)}),""==val&&($(this).addClass("has-error"),counterrors++)}),counterrors>0?(cmck_message_alert("Please fill in all required fields."),!1):($.blockUI({message:null}),$.post($("#form_edit").attr("action"),$("#form_edit").serialize()).fail(function(e){cmck_message_error("Failed to save record. Please try again later or contact your administrator."),$.unblockUI()}).done(function(e){if(void 0!=e.success){if(1==e.success)return location.href=e.redirect,!1;if(void 0!=e.message){if(void 0!=e.error&&1==e.error?cmck_message_error(e.message):cmck_message_alert(e.message),void 0!=e.properties)for(i=0;i<e.properties.length;i++)property=e.properties[i],input=$('input[name="'+property+'"]'),id=input.attr("id"),$('div.form-group[data-formelement="'+id+'"]').addClass("has-error");return $.unblockUI(),!1}}cmck_message_error("Failed to save record. Please try again later or contact your administrator."),$.unblockUI()}),!1))}),$(".button_delete").click(function(){var e=$(this).attr("href");return bootbox.confirm("Are you sure?",function(t){t&&(document.location=e)}),!1}),$("#form_edit_button_transfer").click(function(){return cmck_modal($(this).attr("href")),!1}),$(document).keydown(function(e){return"115"!=e.which&&"83"!=e.which||!e.ctrlKey&&!e.metaKey||(e.preventDefault(),$("#form_edit_button_submit").click(),!1)}),$.event.trigger("cmck",{type:"editForm.init"})}),$(document).ready(function(){$("#form_files_button_create_folder").click(function(){var e={};return $("#modal_files_create_folder").modal(e),!1}),$("#form_files_button_upload_file").click(function(){var e={};return $("#modal_files_upload_file").modal(e),!1}),$("#form_files_button_delete_folder").click(function(){var e={};return $("#modal_files_delete_folder").modal(e),!1}),$(".files-file-zoom").click(function(){$("#modal_files_file_zoom_title").html($(this).attr("data-title")),$("#modal_files_file_zoom_iframe").attr("src",$(this).attr("href"));var e={keyboard:!0};return $("#modal_files_file_zoom").modal(e),!1}),$(".files-file-edit").click(function(){$("#modal_files_file_original_id").val($(this).attr("data-title")),$("#modal_files_file_rename_id").val($(this).attr("data-title"));var e={keyboard:!0};return $("#modal_files_file_edit").modal(e),!1}),$(".files-delete-file").click(function(){$("#modal_files_file_delete_title").html($(this).attr("data-title")),$("#modal_files_file_delete_id").val($(this).attr("data-title"));var e={keyboard:!0};return $("#modal_files_delete_file").modal(e),!1})}),$(document).ready(function(){$(".feedback .alert-success").delay(2e3).fadeOut(500),$(".feedback .alert-info").delay(2500).fadeOut(500),$(".feedback .alert-warning").delay(3e3).fadeOut(500),$(".feedback .alert-danger").delay(4500).fadeOut(500)}),$(".timeshift-blink").each(function(){var e=$(this);setInterval(function(){"hidden"==e.css("visibility")?e.css("visibility","visible"):e.css("visibility","hidden")},500)}),$(document).ready(function(){$("#listing_filter select").change(function(){$("#listing_filter").submit()})}),$(document).ready(function(){$("ol.sortable-tree").nestedSortable({handle:"div",items:"li.sortable-item",toleranceElement:"> div",protectRoot:!0,opacity:.5,revert:250,tabSize:10,tolerance:"pointer",connectWith:".sortable-tree"}),$("#form_sort_button_save").click(function(){$("ol.sortable-tree").nestedSortable({items:"li"}),nested=$("ol.sortable-tree").nestedSortable("toArray",{startDepthCount:-1}),tree=[],$.each(nested,function(e,t){if(t.depth>0){var n={id:t.item_id,parent_id:t.parent_id};tree.push(n)}}),$.blockUI({message:null}),$("#form_sort_list").val(JSON.stringify(tree))})}),function(e){e(document).on("cmck",function(t,n){switch(n.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":e(".datepicker").each(function(){e(this).datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showWeek:!1,firstDay:1,numberOfMonths:1,showButtonPanel:!1})})}})}(jQuery),function(e){e.fn.cmck_fe_email=function(){var t=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},n=function(n){if(e(this).removeClass("alert-success"),e(this).removeClass("alert-danger"),email=e(this).val(),""!=email){var a=e(this);t(email)?(a.addClass("alert-success"),a.removeClass("alert-danger")):(a.addClass("alert-danger"),a.removeClass("alert-success"))}};e(document).on("cmck",function(t,a){switch(a.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":e("div.formelement-email input").each(function(){val=e(this).val(),e(this).on("focus",n),e(this).on("blur",n)})}})},e(document).cmck_fe_email()}(jQuery),$(document).ready(function(){$("#listing_button_import").click(function(){return cmck_modal($(this).attr("href")),!1}),$("#listing_button_export").click(function(){return cmck_modal($(this).attr("href")),!1})}),function(e){e(document).on("cmck",function(t,n){switch(n.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":e(".formelement-file-modal-button").off(),e(".formelement-file-modal-button").click(function(){var t=e(e(this).attr("data-input"));return parent.cmck_set_var("fe_file_property",t),parent.cmck_modal(e(this).attr("href")),!1}),e(".formelement-file-modal-button-view").off(),e(".formelement-file-modal-button-view").click(function(){var t=e(this).attr("data-input"),n=e(t).val();e(parent.document).find("#modal_files_file_zoom_title").html(n);var a=e(t).attr("data-url-view")+n;return e(parent.document).find("#modal_files_file_zoom_iframe").attr("src",a),e.ajax({url:a,type:"HEAD"}).always(function(e){void 0!=e&&404==e.status?alert("File not found. Please check file path."):parent.cmck_modal_id("modal_files_file_zoom"),parent.cmck_modal_id("modal_files_file_zoom")}),!1}),e(".formelement-file-modal-button-download").off(),e(".formelement-file-modal-button-download").click(function(){var t=e(this).attr("data-input"),n=e(t).val();return""!=n.trim()&&(n=e(this).attr("href")+n,e.ajax({url:n,type:"HEAD"}).always(function(e){if(void 0==e||404!=e.status)return window.location.href=n,!1;alert("File not found. Please check file path.")})),!1}),e(".formelement-file input, .formelement-image input").on("change",function(){var t="#"+e(this).attr("id")+"_preview",n=e(this).val();if(e(t).hide(),e(t+" a").attr("href",""),e(t+" img").attr("src",""),n&&null!=n.toLowerCase().match(/\.(jpeg|jpg|gif|png)$/)){var a=e(this).attr("data-url-view")+n;e.ajax({url:a,type:"HEAD",error:function(){e(t).hide()},success:function(){e(t).show(),e(t+" a").attr("href",a),e(t+" img").attr("src",a)}})}})}})}(jQuery),function(e){e(document).on("cmck",function(t,n){switch(n.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":e(".formelement-geolocation-modal-button").off(),e(".formelement-geolocation-modal-button").click(function(){var t=e(e(this).attr("data-input")+"_lat").val(),n=e(e(this).attr("data-input")+"_long").val(),a=e(this).attr("href")+"/"+t+"/"+n;return parent.cmck_modal(a),!1})}})}(jQuery),function(e){e.fn.cmck_fe_link=function(){var t=function(t){if(e(this).removeClass("alert-success"),e(this).removeClass("alert-danger"),url=e(this).val(),""!=url){var n=e(this);e.ajax({url:"/edit/check/link/"+url,success:function(e){n.removeClass("alert-success"),n.removeClass("alert-warning"),n.removeClass("alert-danger"),200==e?n.addClass("alert-success"):e>400?n.addClass("alert-danger"):n.addClass("alert-warning")}})}};e(document).on("cmck",function(n,a){switch(a.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":e("div.formelement-link input").each(function(){e(this).off("blur"),e(this).on("blur",t)})}})},e(document).cmck_fe_link()}(jQuery),function(e){e(document).on("cmck",function(t,n){switch(n.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":e(".formelement-password input[type=text]").each(function(){e(this).change(function(){e(this).next("input[type=hidden]").val(1)})}),e(".formelement-password-generate-button").each(function(){e(this).click(function(){target=e(this).attr("data-target"),e(target).val(Math.random().toString(36).slice(-8)),e(target).next("input[type=hidden]").val(1)})}),e(".formelement-password-clear-button").each(function(){e(this).click(function(){target=e(this).attr("data-target"),e(target).val(""),e(target).next("input[type=hidden]").val(1),alert("Password cleared.")})})}})}(jQuery),function(e){e(".formelement-reference select").on("change",function(){value=e(this).val(),button=e("#"+e(this).attr("id")+"_edit_button"),""!=value?(e(button).removeClass("disabled"),url=e(button).attr("data-url"),console.log(url),url=url.replace("recordId",value),e(button).attr("href",url)):e(button).addClass("disabled")})}(jQuery),$(function(){$.widget("custom.autocompleteCat",$.ui.autocomplete,{_create:function(){this._super(),this.widget().menu("option","items","> :not(.ui-autocomplete-category)")},_renderMenu:function(e,t){var n=this,a="";$.each(t,function(t,i){var o;i.category!=a&&(void 0!==i.category&&e.append("<li class='ui-autocomplete-category'>"+i.category+"</li>"),a=i.category),o=n._renderItemData(e,i),i.category&&o.attr("aria-label",i.category+" : "+i.label)})}})}),function(e){e.fn.cmck_editsequence=function(){var t=!0,a=function(){init=0,e(".sequence-item").each(function(){e(this).height()>init&&(init=e(this).height())}),c=e("div.sequence-item").length,init+=35*c,c=e("ul.sequence-add-item").first().find("li").length,init+=40*c,init+=50,h=Math.max(200,init),iframe="#form_edit_sequence_"+e("#form_sequence").attr("data-property")+"_iframe",t?(e(iframe,window.parent.document).height(h),t=!1):e(iframe,window.parent.document).animate({height:h+"px"},500)};e(document).on("cmck",function(t,i){switch(i.type){case"sequenceForm.init":case"sequenceForm.refresh":"sequenceForm.refresh"==i.type&&(e(".sequence-accordion").accordion("destroy"),e(".sequence-add-item li a").off("click"),e(".sequence-remove-item").off("click"),e(".sequence-accordion").sortable("refresh")),e(".sequence-accordion").accordion({header:"h3",collapsible:!0,heightStyle:"content",active:parseInt(e("#form_sequence").attr("data-active-item")),activate:function(){a()},animated:"fastslide"}),"sequenceForm.init"==i.type&&e(".sequence-accordion").sortable({axis:"y",handle:"h3",stop:function(e,t){t.item.children("h3").triggerHandler("focusout")}}),e(".sequence-add-item li a").click(function(){insert=e(this).attr("data-insert"),item=e(this).closest("ul").attr("data-item"),e.event.trigger("cmck",{type:"sequenceForm.add",insert:insert,item:item})}),e(".sequence-remove-item").click(function(){item=e(this).attr("data-item"),e.event.trigger("cmck",{type:"sequenceForm.remove",item:item})}),a();break;case"sequenceForm.add":count=parseInt(e("#form_sequence").attr("data-count"))+1,e("#form_sequence").attr("data-count",count),e.get(e("#form_sequence").attr("data-action-add")+"?insert="+i.insert+"&count="+count,function(t){item=i.item,parseInt(item)>0?(e("#form_sequence_item_"+item).after(t),n=e("div.sequence-item").index(e("#form_sequence_item_"+item))+1,e("#form_sequence").attr("data-active-item",n)):(e(".sequence-accordion").append(t),n=e("div.sequence-item").length-1,e("#form_sequence").attr("data-active-item",n)),e.event.trigger("cmck",{type:"sequenceForm.refresh"})});break;case"sequenceForm.remove":item=parseInt(i.item),n=e("div.sequence-item").index(e("#form_sequence_item_"+item)),e("#form_sequence_item_"+item).remove(),n==e("div.sequence-item").length&&(n-=1),e("#form_sequence").attr("data-active-item",n),e.event.trigger("cmck",{type:"editForm.init",refresh:!0})}}),e.event.trigger("cmck",{type:"sequenceForm.init"})},e(document).ready(function(){e(document).cmck_editsequence()})}(jQuery),$(document).ready(function(){$(document).on("cmck",function(e,t){switch(t.type){case"editform.Save":$(".sequence-iframe").each(function(){var e=$(this).contents().find("#form_sequence");$("#form_edit").attr("data-event-countdown",parseInt($("#form_edit").attr("data-event-countdown"))+1),$.post($(e).attr("action"),$(e).serialize(),function(t){$("#form_edit").attr("data-event-countdown",parseInt($("#form_edit").attr("data-event-countdown"))-1),$.event.trigger("cmck",{type:"editform.setProperty",property:$(e).attr("data-property"),value:JSON.stringify(t.sequence),save:!0})},"json")})}})}),function(e){e.fn.cmck_fe_table=function(){var t=function(){e(".formelement-table a").off()},n=function(){e(".formelement-table tbody").sortable({handle:".handle"}),e(".formelement-table td").click(function(){e(this).children("textarea").focus()}),e(".formelement-table a[data-action=plus]").click(function(){var e=a(this),t=i(this);return o(t,e),!1}),e(".formelement-table a[data-action=minus]").click(function(){var e=a(this),t=i(this);return r(t,e),!1}),e(".formelement-table textarea").keydown(function(t){if(9===t.keyCode){var n=e(this).closest("tr").nextAll().length,r=e(this).closest("td").nextAll().length;if(0==n&&1==r){var c=a(this),s=i(this);o(s,c)}}}),e(".formelement-table table").each(function(t){c(e(this).attr("name"))})},a=function(t){var n=e(t).closest("table"),a=e(t).closest("tr"),i=e(n).find("tr");return e(i).index(a)},i=function(t){var n=e(t).closest("table");return e(n).attr("name")},o=function(a,i){var o=parseInt(e("table[name="+a+"]").attr("data-rows"));e("table[name="+a+"]").attr("data-rows",++o);var r=e("table[name="+a+"] th").length-2,c='<tr><td class="handle" width="2%">'+o+"</td>";c+=Array(r+1).join('<td><textarea name="'+a+'[]"></textarea></td>'),c+='<td width="3%"><a class="btn btn-default btn-xs" href="#" tabindex="-1" data-action="plus">+</button></a>  <a class="btn btn-default btn-xs" href="#" tabindex="-1" data-action="minus">-</button></a></td></tr>';var s=e("table[name="+a+"]").find("tr");row=s[i],e(row).after(c),t(),n()},r=function(t,n){var a=e("table[name="+t+"]").find("tr");row=a[n],e(row).remove(),c(t)},c=function(t){var n=e("table[name="+t+"] a[data-action=minus]");e(n).each(function(t){e(this).show()}),1==n.length&&e(n[0]).hide()};e(document).on("cmck",function(e,t){t.type}),n()},e(document).ready(function(){e(document).cmck_fe_table()})}(jQuery);