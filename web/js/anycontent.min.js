/*! AnyContent CMCK 2016-01-22 */
function cmck_modal_id(a,b,c){a="#"+a,$(a).off("shown.bs.modal"),$(a).on("shown.bs.modal",function(){"function"==typeof c&&c()}),$(a).removeData(),$(a+" .modal-header").html(""),$(a+" .modal-body").html(""),$(a+" .modal-footer").html(""),$(a).appendTo("body"),$(a).modal({keyboard:!0}),$(a).load(b)}function cmck_modal(a,b){cmck_modal_id("modal_edit",a,b)}function cmck_modal_id_hide(a){a="#"+a,$(a).modal("hide")}function cmck_modal_hide(){cmck_modal_id_hide("modal_edit")}function cmck_modal_set_property(a,b){$("#form_edit [name="+a+"]").val(b)}function cmck_set_var(a,b){"object"!=typeof $.cmck&&($.cmck={}),$.cmck[a]=b}function cmck_get_var(a,b){return $.cmck[a]}function cmck_trigger_change(a){$(a).trigger("change"),$("iframe").each(function(b,c){"function"==typeof c.contentWindow.cmck_sequence_trigger_change&&c.contentWindow.cmck_sequence_trigger_change(a)})}function cmck_message_info(a){$("#messages").html('<div class="alert alert-info">'+a+"</div>"),$(document).scrollTop(0),$("#messages div").delay(3e3).fadeOut(500)}function cmck_message_alert(a){$("#messages").html('<div class="alert alert-warning">'+a+"</div>"),$(document).scrollTop(0),$("#messages div").delay(3e3).fadeOut(500)}function cmck_message_error(a){$("#messages").html('<div class="alert alert-danger">'+a+"</div>"),$(document).scrollTop(0),$("#messages div").delay(3e3).fadeOut(500)}function cmck_get_cookie(a){var b=window.document.cookie.split(a+"=");return 2==b.length?b.pop().split(";").shift():void 0}function cmck_delete_cookie(a){document.cookie=encodeURIComponent(a)+"=deleted; expires="+new Date(0).toUTCString()}function cmck_document(){return document}function cmck_sequence_trigger_change(a){$(a).trigger("change")}$(document).on("cmck",function(a,b){switch(b.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":$(".formelement-popover").popover({html:!0}),$(".formelement-tooltip").popover({html:!0})}}),$(document).ready(function(){}),$(document).on("cmck",function(a,b){switch(b.type){case"editform.setProperty":$("#form_edit [name="+b.property+"]").val(b.value),1==b.save&&0==parseInt($("#form_edit").attr("data-event-countdown"))&&$("#form_edit").submit()}}),$(document).ready(function(){$("#form_edit_button_save_options a").click(function(){return $("#form_edit_button_save").removeClass("open"),$("#form_edit_button_save input:first").attr("value",$(this).text()),$("#form_edit_button_save_operation").attr("value",$(this).attr("data-operation")),!1}),$("#form_edit_button_submit").click(function(){return $.event.trigger("cmck",{type:"editform.Save"}),$("#form_edit").submit(),!1}),$("#form_edit").submit(function(){return countdown=parseInt($("#form_edit").attr("data-event-countdown")),0==countdown?(counterrors=0,$(".form-group.mandatory").each(function(){$(this).removeClass("has-error"),idFormelement=$(this).attr("data-formelement"),val="",$('[id^="'+idFormelement+'"]').each(function(){val+=$(this).val().trim(),console.log(val)}),""==val&&($(this).addClass("has-error"),counterrors++)}),counterrors>0?(cmck_message_alert("Please fill in all required fields."),!1):($.blockUI({message:null}),$.post($("#form_edit").attr("action"),$("#form_edit").serialize()).fail(function(a){cmck_message_error("Failed to save record. Please try again later or contact your administrator."),$.unblockUI()}).done(function(a){if(void 0!=a.success){if(1==a.success)return location.href=a.redirect,!1;if(void 0!=a.message){if(cmck_message_alert(a.message),void 0!=a.properties)for(i=0;i<a.properties.length;i++)property=a.properties[i],input=$('input[name="'+property+'"]'),id=input.attr("id"),$('div.form-group[data-formelement="'+id+'"]').addClass("has-error");return $.unblockUI(),!1}}cmck_message_error("Failed to save record. Please try again later or contact your administrator."),$.unblockUI()}),!1)):!1}),$("#form_edit_button_transfer").click(function(){return cmck_modal($(this).attr("href")),!1}),$(document).keydown(function(a){return"115"!=a.which&&"83"!=a.which||!a.ctrlKey&&!a.metaKey?!0:(a.preventDefault(),$("#form_edit_button_submit").click(),!1)}),$.event.trigger("cmck",{type:"editForm.init"})}),$(document).ready(function(){$("#form_files_button_create_folder").click(function(){var a={};return $("#modal_files_create_folder").modal(a),!1}),$("#form_files_button_upload_file").click(function(){var a={};return $("#modal_files_upload_file").modal(a),!1}),$("#form_files_button_delete_folder").click(function(){var a={};return $("#modal_files_delete_folder").modal(a),!1}),$(".files-file-zoom").click(function(){$("#modal_files_file_zoom_title").html($(this).attr("data-title")),$("#modal_files_file_zoom_iframe").attr("src",$(this).attr("href"));var a={keyboard:!0};return $("#modal_files_file_zoom").modal(a),!1}),$(".files-file-edit").click(function(){$("#modal_files_file_original_id").val($(this).attr("data-title")),$("#modal_files_file_rename_id").val($(this).attr("data-title"));var a={keyboard:!0};return $("#modal_files_file_edit").modal(a),!1}),$(".files-delete-file").click(function(){$("#modal_files_file_delete_title").html($(this).attr("data-title")),$("#modal_files_file_delete_id").val($(this).attr("data-title"));var a={keyboard:!0};return $("#modal_files_delete_file").modal(a),!1})}),$(document).ready(function(){$(".feedback .alert-success").delay(2e3).fadeOut(500),$(".feedback .alert-info").delay(2500).fadeOut(500),$(".feedback .alert-warning").delay(3e3).fadeOut(500),$(".feedback .alert-danger").delay(4500).fadeOut(500)}),$(".timeshift-blink").each(function(){var a=$(this);setInterval(function(){"hidden"==a.css("visibility")?a.css("visibility","visible"):a.css("visibility","hidden")},500)}),$(document).ready(function(){$("#listing_filter select").change(function(){$("#listing_filter").submit()})}),$(document).ready(function(){$("ol.sortable-tree").nestedSortable({handle:"div",items:"li.sortable-item",toleranceElement:"> div",protectRoot:!0,opacity:.5,revert:250,tabSize:10,tolerance:"pointer",connectWith:".sortable-tree"}),$("#form_sort_button_save").click(function(){$("ol.sortable-tree").nestedSortable({items:"li"}),nested=$("ol.sortable-tree").nestedSortable("toArray",{startDepthCount:-1}),tree=[],$.each(nested,function(a,b){if(b.depth>0){var c={id:b.item_id,parent_id:b.parent_id};tree.push(c)}}),$.blockUI({message:null}),$("#form_sort_list").val(JSON.stringify(tree))})}),function(a){a(document).on("cmck",function(b,c){switch(c.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":a(".datepicker").each(function(){a(this).datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showWeek:!1,firstDay:1,numberOfMonths:1,showButtonPanel:!1})})}})}(jQuery),function(a){a.fn.cmck_fe_email=function(){var b=function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},c=function(c){if(a(this).removeClass("alert-success"),a(this).removeClass("alert-danger"),email=a(this).val(),""!=email){var d=a(this);b(email)?(d.addClass("alert-success"),d.removeClass("alert-danger")):(d.addClass("alert-danger"),d.removeClass("alert-success"))}};a(document).on("cmck",function(b,d){switch(d.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":a("div.formelement-email input").each(function(){val=a(this).val(),a(this).on("focus",c),a(this).on("blur",c)})}})},a(document).cmck_fe_email()}(jQuery),$(document).ready(function(){$("#listing_button_import").click(function(){return cmck_modal($(this).attr("href")),!1}),$("#listing_button_export").click(function(){return cmck_modal($(this).attr("href")),!1})}),function(a){a(document).on("cmck",function(b,c){switch(c.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":a(".formelement-file-modal-button").off(),a(".formelement-file-modal-button").click(function(){var b=a(a(this).attr("data-input"));return parent.cmck_set_var("fe_file_property",b),parent.cmck_modal(a(this).attr("href")),!1}),a(".formelement-file-modal-button-view").off(),a(".formelement-file-modal-button-view").click(function(){var b=a(this).attr("data-input"),c=a(b).val();return a(parent.document).find("#modal_files_file_zoom_title").html(c),a(parent.document).find("#modal_files_file_zoom_iframe").attr("src",a(this).attr("href")+c),a.ajax({url:a(this).attr("href")+c,type:"HEAD"}).always(function(a){void 0!=a&&404==a.status?alert("File not found. Please check file path."):parent.cmck_modal_id("modal_files_file_zoom")}),!1}),a(".formelement-file-modal-button-download").off(),a(".formelement-file-modal-button-download").click(function(){var b=a(this).attr("data-input"),c=a(b).val();return""!=c.trim()&&(c=a(this).attr("href")+c,a.ajax({url:c,type:"HEAD"}).always(function(a){return void 0==a||404!=a.status?(window.location.href=c,!1):void alert("File not found. Please check file path.")})),!1}),a(".formelement-file input, .formelement-image input").on("change",function(){var b="#"+a(this).attr("id")+"_preview",c=a(this).val();if(a(b).hide(),a(b+" a").attr("href",""),a(b+" img").attr("src",""),c&&null!=c.toLowerCase().match(/\.(jpeg|jpg|gif|png)$/)){var d=a(this).attr("data-url-view")+c;a.ajax({url:d,type:"HEAD",error:function(){a(b).hide()},success:function(){a(b).show(),a(b+" a").attr("href",d),a(b+" img").attr("src",d)}})}})}})}(jQuery),function(a){a(document).on("cmck",function(b,c){switch(c.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":a(".formelement-geolocation-modal-button").off(),a(".formelement-geolocation-modal-button").click(function(){var b=a(a(this).attr("data-input")+"_lat").val(),c=a(a(this).attr("data-input")+"_long").val(),d=a(this).attr("href")+"/"+b+"/"+c;return parent.cmck_modal(d),!1})}})}(jQuery),function(a){a.fn.cmck_fe_link=function(){var b=function(b){if(a(this).removeClass("alert-success"),a(this).removeClass("alert-danger"),url=a(this).val(),""!=url){var c=a(this);return void a.ajax({url:"/edit/check/link/"+url,success:function(a){a?(c.addClass("alert-success"),c.removeClass("alert-danger")):(c.addClass("alert-danger"),c.removeClass("alert-success"))}})}};a(document).on("cmck",function(c,d){switch(d.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":a("div.formelement-link input").each(function(){val=a(this).val(),a(this).on("focus",b),a(this).on("blur",b)})}})},a(document).cmck_fe_link()}(jQuery),function(a){a(document).on("cmck",function(b,c){switch(c.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":a(".formelement-password input[type=text]").each(function(){a(this).change(function(){a(this).next("input[type=hidden]").val(1)})}),a(".formelement-password-generate-button").each(function(){a(this).click(function(){target=a(this).attr("data-target"),a(target).val(Math.random().toString(36).slice(-8)),a(target).next("input[type=hidden]").val(1)})}),a(".formelement-password-clear-button").each(function(){a(this).click(function(){target=a(this).attr("data-target"),a(target).val(""),a(target).next("input[type=hidden]").val(1),alert("Password cleared.")})})}})}(jQuery),function(a){a(".formelement-reference select").on("change",function(){value=a(this).val(),button=a("#"+a(this).attr("id")+"_edit_button"),""!=value?(a(button).removeClass("disabled"),url=a(button).attr("data-url"),console.log(url),url=url.replace("recordId",value),a(button).attr("href",url)):a(button).addClass("disabled")})}(jQuery),function(a){a.fn.cmck_editsequence=function(){var b=!0,d=function(){init=0,a(".sequence-item").each(function(){a(this).height()>init&&(init=a(this).height())}),c=a("div.sequence-item").length,init+=35*c,c=a("ul.sequence-add-item").first().find("li").length,init+=40*c,init+=50,h=Math.max(200,init),iframe="#form_edit_sequence_"+a("#form_sequence").attr("data-property")+"_iframe",b?(a(iframe,window.parent.document).height(h),b=!1):a(iframe,window.parent.document).animate({height:h+"px"},500)};a(document).on("cmck",function(b,c){switch(c.type){case"sequenceForm.init":case"sequenceForm.refresh":"sequenceForm.refresh"==c.type&&(a(".sequence-accordion").accordion("destroy"),a(".sequence-add-item li a").off("click"),a(".sequence-remove-item").off("click"),a(".sequence-accordion").sortable("refresh")),a(".sequence-accordion").accordion({header:"h3",collapsible:!0,heightStyle:"content",active:parseInt(a("#form_sequence").attr("data-active-item")),activate:function(){d()},animated:"fastslide"}),"sequenceForm.init"==c.type&&a(".sequence-accordion").sortable({axis:"y",handle:"h3",stop:function(a,b){b.item.children("h3").triggerHandler("focusout")}}),a(".sequence-add-item li a").click(function(){insert=a(this).attr("data-insert"),item=a(this).closest("ul").attr("data-item"),a.event.trigger("cmck",{type:"sequenceForm.add",insert:insert,item:item})}),a(".sequence-remove-item").click(function(){item=a(this).attr("data-item"),a.event.trigger("cmck",{type:"sequenceForm.remove",item:item})}),d();break;case"sequenceForm.add":count=parseInt(a("#form_sequence").attr("data-count"))+1,a("#form_sequence").attr("data-count",count),a.get(a("#form_sequence").attr("data-action-add")+"?insert="+c.insert+"&count="+count,function(b){item=c.item,parseInt(item)>0?(a("#form_sequence_item_"+item).after(b),n=a("div.sequence-item").index(a("#form_sequence_item_"+item))+1,a("#form_sequence").attr("data-active-item",n)):(a(".sequence-accordion").append(b),n=a("div.sequence-item").length-1,a("#form_sequence").attr("data-active-item",n)),a.event.trigger("cmck",{type:"sequenceForm.refresh"})});break;case"sequenceForm.remove":item=parseInt(c.item),n=a("div.sequence-item").index(a("#form_sequence_item_"+item)),a("#form_sequence_item_"+item).remove(),n==a("div.sequence-item").length&&(n-=1),a("#form_sequence").attr("data-active-item",n),a.event.trigger("cmck",{type:"editForm.init",refresh:!0})}}),a.event.trigger("cmck",{type:"sequenceForm.init"})},a(document).ready(function(){a(document).cmck_editsequence()})}(jQuery),$(document).ready(function(){$(document).on("cmck",function(a,b){switch(b.type){case"editform.Save":$(".sequence-iframe").each(function(){var a=$(this).contents().find("#form_sequence");$("#form_edit").attr("data-event-countdown",parseInt($("#form_edit").attr("data-event-countdown"))+1),$.post($(a).attr("action"),$(a).serialize(),function(b){$("#form_edit").attr("data-event-countdown",parseInt($("#form_edit").attr("data-event-countdown"))-1),$.event.trigger("cmck",{type:"editform.setProperty",property:$(a).attr("data-property"),value:JSON.stringify(b.sequence),save:!0})},"json")})}})}),function(a){a.fn.cmck_fe_table=function(){var b=function(){a(".formelement-table a").off()},c=function(){a(".formelement-table tbody").sortable({handle:".handle"}),a(".formelement-table td").click(function(){var b=a(this).children("textarea");b.focus()}),a(".formelement-table a[data-action=plus]").click(function(){var a=d(this),b=e(this);return f(b,a),!1}),a(".formelement-table a[data-action=minus]").click(function(){var a=d(this),b=e(this);return g(b,a),!1}),a(".formelement-table textarea").keydown(function(b){if(9===b.keyCode){var c=a(this).closest("tr").nextAll().length,g=a(this).closest("td").nextAll().length;if(0==c&&1==g){var h=d(this),i=e(this);f(i,h)}}}),a(".formelement-table table").each(function(b){h(a(this).attr("name"))})},d=function(b){var c=a(b).closest("table"),d=a(b).closest("tr"),e=a(c).find("tr");return a(e).index(d)},e=function(b){var c=a(b).closest("table");return a(c).attr("name")},f=function(d,e){var f=parseInt(a("table[name="+d+"]").attr("data-rows"));a("table[name="+d+"]").attr("data-rows",++f);var g=a("table[name="+d+"] th").length-2,h='<tr><td class="handle" width="2%">'+f+"</td>";h+=Array(g+1).join('<td><textarea name="'+d+'[]"></textarea></td>'),h+='<td width="3%"><a class="btn btn-default btn-xs" href="#" tabindex="-1" data-action="plus">+</button></a>  <a class="btn btn-default btn-xs" href="#" tabindex="-1" data-action="minus">-</button></a></td></tr>';var i=a("table[name="+d+"]").find("tr");row=i[e],a(row).after(h),b(),c()},g=function(b,c){var d=a("table[name="+b+"]").find("tr");row=d[c],a(row).remove(),h(b)},h=function(b){var c=a("table[name="+b+"] a[data-action=minus]");a(c).each(function(b){a(this).show()}),1==c.length&&a(c[0]).hide()};a(document).on("cmck",function(a,b){switch(b.type){case"editForm.init":}}),c()},a(document).ready(function(){a(document).cmck_fe_table()})}(jQuery);